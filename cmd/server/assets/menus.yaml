# Deployer Module Menu Definitions
# This file defines the menu structure for the Deployer module
# Used by admin service for dynamic menu registration

module:
  id: deployer
  name: Deployer
  description: Certificate Deployment Service

menus:
  - id: deployer
    parent_id: null
    type: CATALOG
    name: Deployer
    path: /deployer
    icon: lucide:rocket
    order: 410
    authority:
      - platform:admin
      - tenant:manager

  - id: deployer-jobs
    parent_id: deployer
    type: MENU
    name: Deployment Jobs
    path: job
    component: app/deployer/job/index.vue
    icon: lucide:list-todo
    order: 1
    authority:
      - platform:admin
      - tenant:manager

  - id: deployer-targets
    parent_id: deployer
    type: MENU
    name: Deployment Targets
    path: target
    component: app/deployer/target/index.vue
    icon: lucide:target
    order: 2
    authority:
      - platform:admin
      - tenant:manager

  - id: deployer-configurations
    parent_id: deployer
    type: MENU
    name: Target Configurations
    path: configuration
    component: app/deployer/configuration/index.vue
    icon: lucide:settings-2
    order: 3
    authority:
      - platform:admin
      - tenant:manager

dashboard_widgets:
  - id: deployer.targets_total
    name: Deployment Targets
    description: Active and total deployment target counts
    icon: lucide:target
    widget_type: stat_card
    data_source:
      endpoint: /admin/v1/modules/deployer/v1/statistics
      method: GET
    data_mapping:
      value_path: targets.activeCount
      total_path: targets.totalCount
      label: Targets
    default_size:
      width: 3
      height: 1
    tags: [deployer, overview]
    authority: [platform:admin, tenant:manager]

  - id: deployer.job_trends_line
    name: Job Trends
    description: Line chart of deployment job trends over time
    icon: lucide:trending-up
    widget_type: line_chart
    data_source:
      endpoint: /admin/v1/modules/deployer/v1/statistics
      method: GET
    data_mapping:
      categories_path: jobs.dailyStats
      category_field: date
      series_fields: succeededCount,failedCount
      series_labels: Succeeded,Failed
    default_size:
      width: 4
      height: 2
    tags: [deployer, chart]
    authority: [platform:admin, tenant:manager]

  - id: deployer.success_gauge
    name: Deployment Success Rate
    description: Gauge showing deployment success rate
    icon: lucide:gauge
    widget_type: gauge
    data_source:
      endpoint: /admin/v1/modules/deployer/v1/statistics
      method: GET
    data_mapping:
      value_path: jobs.successRate
      label: Success Rate
    default_size:
      width: 4
      height: 2
    tags: [deployer, chart]
    authority: [platform:admin, tenant:manager]

  - id: deployer.job_status_pie
    name: Job Status Distribution
    description: Pie chart of deployment job statuses
    icon: lucide:pie-chart
    widget_type: pie_chart
    data_source:
      endpoint: /admin/v1/modules/deployer/v1/statistics
      method: GET
    data_mapping:
      series_path: jobs
      series_fields: completedCount,failedCount,pendingCount,processingCount,cancelledCount,retryingCount
      series_labels: Completed,Failed,Pending,Processing,Cancelled,Retrying
    default_size:
      width: 4
      height: 2
    tags: [deployer, chart]
    authority: [platform:admin, tenant:manager]

  - id: deployer.config_by_provider
    name: Configs by Provider
    description: Deployment configurations grouped by provider type
    icon: lucide:cloud
    widget_type: pie_chart
    data_source:
      endpoint: /admin/v1/modules/deployer/v1/statistics
      method: GET
    data_mapping:
      data_path: configurations.byProviderType
      label: Provider Type
    default_size:
      width: 4
      height: 2
    tags: [deployer, chart]
    authority: [platform:admin, tenant:manager]

  - id: deployer.auto_deploy_stat
    name: Auto-Deploy Targets
    description: Targets with auto-deploy enabled
    icon: lucide:zap
    widget_type: stat_card
    data_source:
      endpoint: /admin/v1/modules/deployer/v1/statistics
      method: GET
    data_mapping:
      value_path: targets.autoDeployEnabledCount
      total_path: targets.totalCount
      label: Auto-Deploy
    default_size:
      width: 3
      height: 1
    tags: [deployer, overview]
    authority: [platform:admin, tenant:manager]

permission_groups:
  - name: Deployer
    module: deployer
    description: Deployer Certificate Deployment Permissions
    permissions:
      - name: View Jobs
        code: deployer.job.view
        description: View deployment jobs
      - name: Create Jobs
        code: deployer.job.create
        description: Create new deployment jobs
      - name: Update Jobs
        code: deployer.job.update
        description: Update deployment jobs
      - name: Delete Jobs
        code: deployer.job.delete
        description: Delete deployment jobs
      - name: View Targets
        code: deployer.target.view
        description: View deployment targets
      - name: Manage Targets
        code: deployer.target.manage
        description: Create, update, and delete deployment targets
      - name: Manage Configurations
        code: deployer.configuration.manage
        description: Manage target configurations

roles:
  - name: Deployer Administrator
    code: deployer.admin
    description: Full access to Deployer module
    is_system: true
    permissions:
      - deployer.job.view
      - deployer.job.create
      - deployer.job.update
      - deployer.job.delete
      - deployer.target.view
      - deployer.target.manage
      - deployer.configuration.manage

  - name: Deployer Operator
    code: deployer.operator
    description: Can create and manage deployment jobs
    is_system: true
    permissions:
      - deployer.job.view
      - deployer.job.create
      - deployer.job.update
      - deployer.target.view

  - name: Deployer Viewer
    code: deployer.viewer
    description: Read-only access to Deployer module
    is_system: true
    permissions:
      - deployer.job.view
      - deployer.target.view
